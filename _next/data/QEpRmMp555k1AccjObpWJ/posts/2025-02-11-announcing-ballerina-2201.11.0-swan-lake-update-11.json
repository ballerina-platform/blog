{"pageProps":{"frontmatter":{"layout":"blog-post","title":"Announcing Ballerina Swan Lake Update 11 (2201.11.0)","author":"Waruna Jayaweera","published-date":"11 Feb 2025","status":"Published","socialmediaimage":"ballerina-generic-social-media-image-2023.png","permalink":"/posts/2025-02-11-announcing-ballerina-2201.11.0-swan-lake-update-11/"},"content":"\n<style>.cBlogContent p{white-space: break-spaces !important;}</style>\n\nThe Ballerina team is excited to announce the eleventh update release of Ballerina Swan Lake, Ballerina Swan Lake Update 11 (2201.11.0). This update adds support for Java 21, along with performance improvements and new features for the Ballerina library and developer tools.\n## Runtime\n### Java 21 Support\nThe Ballerina runtime now supports Java 21, the latest long-term support (LTS) release of the Java platform. Ballerina's existing concurrency model has been implemented with virtual threads and the newest concurrency features in Java 21.\n\nBallerina models concurrency using the concept of \"Strand\". A new strand is created via a named worker, the 'start' action, or any entry point execution, such as the main function or a resource method. A strand can yield during execution, for instance, while waiting for a worker's result or a network response. This allows other strands to share underlying OS threads.\n\nStrands are lightweight threads, similar to Go routines. Earlier versions of Java did not have a green thread concept. Strands cannot be directly mapped to Java threads either, as Java threads are directly mapped to operating system threads. Creating a traditional Java thread for each strand would lead to memory and performance limitations. Therefore, we implemented a user-space scheduler for Ballerina strands. The Ballerina scheduler assigns strands to available Java threads from the Ballerina thread pool and manages yield points to prevent blocking of Java threads.\n\nAdditionally, the Ballerina scheduler maintains the state of strands to model their asynchronous behavior with yield points. Java switch cases are generated for each Ballerina function to manage these yield states, enabling execution to resume once the yield operation is complete.\n\nHowever, generating switch cases for each function causes significant performance degradation, especially in loops. Moreover, the complexity of handling asynchronous operations has made native runtime APIs more complicated. This complexity in the concurrency model also impacts other Ballerina concurrency features, such as workers, worker interactions, and locks, etc.\n\nWith the official support for Java virtual threads in Java 21 LTS, transitioning to a virtual threads-based concurrency model will eliminate the need for switch case-based code generation to support asynchronous execution. Now, the strand is mapped directly to the virtual thread, and the Ballerina scheduler is no longer required. This change has enhanced the performance of the identified scenarios and provided a clearer set of APIs for native code developers.\n\n### Performance Improvements\nBy implementing the Ballerina concurrency model with Java Virtual Threads in Update 11, there have been substantial performance improvements. We have conducted performance tests and observed significant reductions in CPU-bound operations, memory usage, GraalVM execution time, and the size of the generated executables.\n\n#### CPU Bound Operations\nRecent improvements, especially in array access and loop optimizations, have led to a substantial performance boost. For example, the following benchmark code segment runs over 20 times faster than in Ballerina Swan Lake Update 10.\n\n```ballerina\npublic function main(string... args) returns error? {\n   int u = check int:fromString(args[0]);\n   int r = check random:createIntInRange(1, 10000);\n   int[10000] a = [];\n   foreach int i in 0..<10000 {\n       foreach int j in 0..<100000 {\n           a[i] = a[i] + j % u;\n       }\n       a[i] += r;\n   }\n}\n```\n\n<img alt=\"Loops U10 Vs U11\" src=\"/images/u11/loops-performance-u10-vs-u11.png\">\n\nThe following code computes the Fibonacci sequence for ùëõ = 52. With the optimizations in Swan Lake Update 11, performance has doubled compared to Ballerina Swan Lake Update 10.\n\n```ballerina\nfunction fibonacci(int n) returns int {\n   if (n <= 1) {\n       return n;\n   }\n   return fibonacci(n - 1) + fibonacci(n - 2);\n}\n\n\npublic function main() {\n   int n = 52; // Adjust this number to increase the load\n   int result = fibonacci(n);\n}\n```\n\n<img alt=\"Loops U10 Vs U11\" src=\"/images/u11/fibonacci-u10-vs-u11.png\">\n\nPerformance tests on query expressions involving loops have demonstrated up to a 2x improvement.\n\n<img alt=\"Loops U10 Vs U11\" src=\"/images/u11/query-expressions-with-loops-u10-vs-u11.png\">\n\n#### File Size\n\nSince generated executable codes have been reduced with Update 11, there is a notable reduction in module build files and final executable sizes.\n\n<img alt=\"Loops U10 Vs U11\" src=\"/images/u11/file-size-u10-vs-u11.png\">\n\n#### GraalVM Build Time\n\nThe latest improvements have shown a 25% reduction in GraalVM build time as well.\n\n<img alt=\"Loops U10 Vs U11\" src=\"/images/u11/graalvm-build-time-u10-vs-u11.png\">\n\n#### Memory\n\nPerformance tests were conducted to evaluate the heap memory usage of Ballerina Update 10 and Update 11. Since garbage collection causes fluctuations in memory usage during execution, this analysis focuses on the peak heap memory recorded for each test, demonstrating a significant reduction in memory consumption.\n\n<img alt=\"Loops U10 Vs U11\" src=\"/images/u11/peak-heap-memory-u10-vs-u11.png\">\n\n### Strand Dump Tool\n\nThe strand dump tool has been enhanced to support virtual threads. The report now includes the total strand count, identifies strands running in parallel and sequentially, and provides their corresponding stack traces.\n\nIn the updated concurrency model, every strand is directly mapped to a Java virtual thread, and the tool extracts strand-related details from the virtual thread dump. However, since the thread dump does not include virtual thread states, the current version of the strand dump report does not display strand states.\n\n## Ballerina Library Features\n\n### New data.csv module\n\nThe data.csv module has been introduced with constraint validation support, enabling output validation against constraints defined in the target type. Additionally, the module supports parsing CSV data with union types as expected types, enhancing data flexibility and accuracy.\n\n### The data.xmldata module\n\nThe data.xmldata module has been enhanced with support for XML Schema Definition (XSD) Sequence and Choice. It now also includes union-type support for XML operations, along with the ability to handle singleton types, unions of singletons, and enums, improving XML data processing flexibility.  \nPlease refer to the release note for further information on the data.xml module.\n\n### The Crypto package\n\nThe Crypto package has been enhanced with support for PGP encryption and decryption with streams, Bcrypt, Argon2, and Keccak-256 hashing and verification.\n\n### The HTTP package\n\nHTTP package has added lax binding support for service and client data binding, allowing greater flexibility. This enables nil values to be bound to optional fields and absent values to be assigned to nilable fields.\n\n### The LDAP package\n\nThe LDAP package now supports secure LDAP (LDAPS) connections using SSL/TLS, enabling applications to authenticate and interact with LDAP directories over encrypted connections.\n\n## Developer tools\n\nThe OpenAPI tool has been enhanced with new features. New WSDL and XSD tools have been introduced.\n\n### OpenAPI tool\n\nThe OpenAPI tool has introduced the following new features.\n\n* Introduced the `flatten` sub-command, which flattens the OpenAPI contract file by moving all the inline schemas to the components section. The output is a modified OpenAPI contract.\n\n```\n$ bal openapi flatten <openapi.yaml>\n```\n\n* Introduced the `align` sub-command, which aligns the OpenAPI contract file according to Ballerina's naming practices. The Ballerina name extensions are added to the schemas, which can not be modified directly. The output is a modified OpenAPI contract.\n\n```\n$ bal openpai align <openapi.yaml>\n```\n\n* Code generation support has been added with the new Ballerina name extensions, which are mapped as relevant annotations in the generated types, parameters, and record fields. This support is available for client, service implementation, and service type code generation. Additionally, relaxed data binding for client-side payloads has been introduced, allowing nil values to be considered optional and treating absent fields as nilable types.\n\n### WSDL tool\n\nA new tool is introduced to generate Ballerina clients and record types from a given WSDL file. This simplifies the integration with SOAP-based web services by automatically generating necessary types and client functions.\n\n```\n $ bal wsdl <wsdl-file-path> [--operations <operation-uris>] [--module <output-module-name>] [--port <port-name>]\n```\n\n### XSD tool\n\nA new tool is introduced to generate Ballerina record types from an XSD file, simplifying integration with XML-based operations in Ballerina.\n\n```\n  $ bal xsd <xsd-file-path> --module <output-module-name>\n```\n\n## Ballerina packages\n### Package documentation\nEnhanced the developer experience in managing package and module documentation with a more streamlined approach. README.md is now the default package documentation file, eliminating redundancy between Package.md and Module.md. In single-module packages, Module.md is no longer required, reducing duplication and simplifying documentation management. For multi-module projects, README.md can still be added to non-default modules if necessary.\n\nAdditionally, support for specifying a custom .md file in Ballerina.toml has been introduced, providing greater flexibility. These improvements ensure seamless documentation display on platforms that prioritize README.md while reducing the effort needed to maintain multiple documentation files.\n\nFurthermore, this release brings a range of notable additions and improvements to the language, runtime, Ballerina library, and developer tools. For a comprehensive overview of all the new features and improvements brought by Swan Lake Update 11, see the [release note](https://ballerina.io/downloads/swan-lake-release-notes/swan-lake-2201.11.0).\n\nWe encourage our community to explore these features and provide feedback. Your input is invaluable in shaping the future of Ballerina and ensuring it meets your needs.\n\nCheers to the Ballerina community and the bright future of it!\n","codes":"[[-1219082381,\"<pre class=\\\"shiki github-light\\\" style=\\\"background-color: #ffffff\\\"><code><span class=\\\"line\\\"><span style=\\\"color: #CF222E\\\">public</span><span style=\\\"color: #24292F\\\"> </span><span style=\\\"color: #CF222E\\\">function</span><span style=\\\"color: #24292F\\\"> </span><span style=\\\"color: #8250DF\\\">main</span><span style=\\\"color: #24292F\\\">(</span><span style=\\\"color: #0550AE\\\">string</span><span style=\\\"color: #CF222E\\\">...</span><span style=\\\"color: #24292F\\\"> </span><span style=\\\"color: #953800\\\">args</span><span style=\\\"color: #24292F\\\">) </span><span style=\\\"color: #CF222E\\\">returns</span><span style=\\\"color: #24292F\\\"> </span><span style=\\\"color: #CF222E\\\">error?</span><span style=\\\"color: #24292F\\\"> {</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color: #24292F\\\">   </span><span style=\\\"color: #0550AE\\\">int</span><span style=\\\"color: #24292F\\\"> u </span><span style=\\\"color: #CF222E\\\">=</span><span style=\\\"color: #24292F\\\"> </span><span style=\\\"color: #CF222E\\\">check</span><span style=\\\"color: #24292F\\\"> </span><span style=\\\"color: #0550AE\\\">int</span><span style=\\\"color: #CF222E\\\">:</span><span style=\\\"color: #8250DF\\\">fromString</span><span style=\\\"color: #24292F\\\">(</span><span style=\\\"color: #953800\\\">args</span><span style=\\\"color: #24292F\\\">[</span><span style=\\\"color: #0550AE\\\">0</span><span style=\\\"color: #24292F\\\">]);</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color: #24292F\\\">   </span><span style=\\\"color: #0550AE\\\">int</span><span style=\\\"color: #24292F\\\"> r </span><span style=\\\"color: #CF222E\\\">=</span><span style=\\\"color: #24292F\\\"> </span><span style=\\\"color: #CF222E\\\">check</span><span style=\\\"color: #24292F\\\"> random</span><span style=\\\"color: #CF222E\\\">:</span><span style=\\\"color: #8250DF\\\">createIntInRange</span><span style=\\\"color: #24292F\\\">(</span><span style=\\\"color: #0550AE\\\">1</span><span style=\\\"color: #24292F\\\">, </span><span style=\\\"color: #0550AE\\\">10000</span><span style=\\\"color: #24292F\\\">);</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color: #24292F\\\">   </span><span style=\\\"color: #0550AE\\\">int</span><span style=\\\"color: #24292F\\\">[</span><span style=\\\"color: #0550AE\\\">10000</span><span style=\\\"color: #24292F\\\">] a </span><span style=\\\"color: #CF222E\\\">=</span><span style=\\\"color: #24292F\\\"> [];</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color: #24292F\\\">   </span><span style=\\\"color: #CF222E\\\">foreach </span><span style=\\\"color: #0550AE\\\">int</span><span style=\\\"color: #24292F\\\"> i </span><span style=\\\"color: #CF222E\\\">in</span><span style=\\\"color: #24292F\\\"> </span><span style=\\\"color: #0550AE\\\">0</span><span style=\\\"color: #24292F\\\">..</span><span style=\\\"color: #CF222E\\\">&lt;</span><span style=\\\"color: #0550AE\\\">10000</span><span style=\\\"color: #24292F\\\"> {</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color: #24292F\\\">       </span><span style=\\\"color: #CF222E\\\">foreach </span><span style=\\\"color: #0550AE\\\">int</span><span style=\\\"color: #24292F\\\"> j </span><span style=\\\"color: #CF222E\\\">in</span><span style=\\\"color: #24292F\\\"> </span><span style=\\\"color: #0550AE\\\">0</span><span style=\\\"color: #24292F\\\">..</span><span style=\\\"color: #CF222E\\\">&lt;</span><span style=\\\"color: #0550AE\\\">100000</span><span style=\\\"color: #24292F\\\"> {</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color: #24292F\\\">           a[i] </span><span style=\\\"color: #CF222E\\\">=</span><span style=\\\"color: #24292F\\\"> a[i] </span><span style=\\\"color: #CF222E\\\">+</span><span style=\\\"color: #24292F\\\"> j </span><span style=\\\"color: #CF222E\\\">%</span><span style=\\\"color: #24292F\\\"> u;</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color: #24292F\\\">       }</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color: #24292F\\\">       a[i] </span><span style=\\\"color: #CF222E\\\">+=</span><span style=\\\"color: #24292F\\\"> r;</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color: #24292F\\\">   }</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color: #24292F\\\">}</span></span></code></pre>\"],[1346342902,\"<pre class=\\\"shiki github-light\\\" style=\\\"background-color: #ffffff\\\"><code><span class=\\\"line\\\"><span style=\\\"color: #CF222E\\\">function</span><span style=\\\"color: #24292F\\\"> </span><span style=\\\"color: #8250DF\\\">fibonacci</span><span style=\\\"color: #24292F\\\">(</span><span style=\\\"color: #0550AE\\\">int</span><span style=\\\"color: #24292F\\\"> </span><span style=\\\"color: #953800\\\">n</span><span style=\\\"color: #24292F\\\">) </span><span style=\\\"color: #CF222E\\\">returns</span><span style=\\\"color: #24292F\\\"> </span><span style=\\\"color: #0550AE\\\">int</span><span style=\\\"color: #24292F\\\"> {</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color: #24292F\\\">   </span><span style=\\\"color: #CF222E\\\">if</span><span style=\\\"color: #24292F\\\"> (n </span><span style=\\\"color: #CF222E\\\">&lt;=</span><span style=\\\"color: #24292F\\\"> </span><span style=\\\"color: #0550AE\\\">1</span><span style=\\\"color: #24292F\\\">) {</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color: #24292F\\\">       </span><span style=\\\"color: #CF222E\\\">return</span><span style=\\\"color: #24292F\\\"> n;</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color: #24292F\\\">   }</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color: #24292F\\\">   </span><span style=\\\"color: #CF222E\\\">return</span><span style=\\\"color: #24292F\\\"> </span><span style=\\\"color: #8250DF\\\">fibonacci</span><span style=\\\"color: #24292F\\\">(</span><span style=\\\"color: #953800\\\">n</span><span style=\\\"color: #24292F\\\"> </span><span style=\\\"color: #CF222E\\\">-</span><span style=\\\"color: #24292F\\\"> </span><span style=\\\"color: #0550AE\\\">1</span><span style=\\\"color: #24292F\\\">) </span><span style=\\\"color: #CF222E\\\">+</span><span style=\\\"color: #24292F\\\"> </span><span style=\\\"color: #8250DF\\\">fibonacci</span><span style=\\\"color: #24292F\\\">(</span><span style=\\\"color: #953800\\\">n</span><span style=\\\"color: #24292F\\\"> </span><span style=\\\"color: #CF222E\\\">-</span><span style=\\\"color: #24292F\\\"> </span><span style=\\\"color: #0550AE\\\">2</span><span style=\\\"color: #24292F\\\">);</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color: #24292F\\\">}</span></span>\\n<span class=\\\"line\\\"></span>\\n<span class=\\\"line\\\"></span>\\n<span class=\\\"line\\\"><span style=\\\"color: #CF222E\\\">public</span><span style=\\\"color: #24292F\\\"> </span><span style=\\\"color: #CF222E\\\">function</span><span style=\\\"color: #24292F\\\"> </span><span style=\\\"color: #8250DF\\\">main</span><span style=\\\"color: #24292F\\\">() {</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color: #24292F\\\">   </span><span style=\\\"color: #0550AE\\\">int</span><span style=\\\"color: #24292F\\\"> n </span><span style=\\\"color: #CF222E\\\">=</span><span style=\\\"color: #24292F\\\"> </span><span style=\\\"color: #0550AE\\\">52</span><span style=\\\"color: #24292F\\\">; </span><span style=\\\"color: #6E7781\\\">// Adjust this number to increase the load</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color: #24292F\\\">   </span><span style=\\\"color: #0550AE\\\">int</span><span style=\\\"color: #24292F\\\"> result </span><span style=\\\"color: #CF222E\\\">=</span><span style=\\\"color: #24292F\\\"> </span><span style=\\\"color: #8250DF\\\">fibonacci</span><span style=\\\"color: #24292F\\\">(</span><span style=\\\"color: #953800\\\">n</span><span style=\\\"color: #24292F\\\">);</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color: #24292F\\\">}</span></span></code></pre>\"]]","slug":"2025-02-11-announcing-ballerina-2201.11.0-swan-lake-update-11"},"__N_SSG":true}